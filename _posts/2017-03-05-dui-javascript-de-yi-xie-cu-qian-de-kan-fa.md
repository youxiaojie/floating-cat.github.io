---
layout: post
title: 对 Javascript 的一些粗浅的看法
date: "2017-03-05 19:09:00 +0800"
categories: 
  - programming
published: false
---

> 该文章已经中途放弃。也许应该写一些更有建议性或者有趣一点的文章。

最近看了好些 JS 的书和一些 JS 相关的文章，感觉我对 JS 本身大体上应该有了一个还算不错的认识。这篇文章大概讲一下我对 JS 语言的一些个人的粗浅的看法（带有略微的批判性）。

### JS 是一门有很多意外性复杂的语言
实际上我觉得 JS 的核心部分并没有那么难，但是非常多 JS 相关的意外性复杂加剧了学习这门语言的难度。
#### JS 的语言设计（一些语法和语义）
网上有非常多对这方面进行的批评，这里我就不多说了。除了那些在很多人看来有致命缺点的语言的设计外，我想谈谈我对 JS 中的一些语言的设计的看法。

[拿 function expressions/declaration 和 `object` 字面值/带有 label 的 block 块来说，在很多情况下，我们要根据这段代码在上下文中的位置来判断语义，这也就是为什么 IIFE 正常情况下要通过括号来使用。][1]

还有比如说 `new` 一个 `function` 和直接调用一个 `function` 的语义完全不同，但是却又通过同一种声明形式（通过 `function`）来定义，然后类似于 `Number()` 这样的东西是一个强制转换，而 `Object()` 却是一个包装的方法。

另外 JS 还在很多的语法细节上有太多不平整的地方，比如说 `switch` 里的 `default` 可以放到中间位置，并可以在没有任何 `case` 成立的情况下从 `default` fall through 下来。比如说当你 `new` 一个 `function` 的时候，如果你返回一个基础类型的值的话，那么这个构造函数就会返回这个构造函数本身对应的子类对象，而当你返回一个对象类型的值时，返回值就替换了原本这个构造函数对应的那个类型的值。除此之外，这样的不一致的地方还有非常多。

JS 的语言设计上有太多的缺陷，而这些缺陷严重加剧了这门语言的意外性复杂性。拿 《You Don't Know JS: Types & Grammar》 来说，这书用了 60 多页来仔细地介绍 JS 的强制转换。

虽然这几年来 JS 语言进化的很快，但是我觉得 JS 乃至社团应该更激进点——对很多 JS 语言设计上的缺陷进行限制乃至抑制。如果一门语言设计上的缺陷让一个入门这门语言的人在非常多的时候学习这门语言的意外性复杂的话，那么这必将是有害的。

#### JS 的标准库的设计
JS 的标准库比起其他语言来说很小，但是实际上也存在着好些问题。从我学习起 JS 的那天，我就非常困惑那些像数组一样的对象，更困惑用 `Array` 原型里的方法对这些对象进行处理。我觉得 JS 语言应该采取其他更好的手段（比如说建一个其他的工具对象）来避免这样子的奇淫技巧或者是用其他方式慢慢地改进这种不合理的方式，并且彻底地 deprecated 掉像 `isNaN()` 这样的方法。

#### 历史的错 & 浏览器 的 console/Node.js 的 REPL 里的一些 JS 行为的不一致
前者比如说 `document.all`，后者

可以说 JS 乃至 JS 相关的很多东西中的那些很明显的抽象漏洞也是导致 JS 有这么多意外性复杂的原因之一。

### JS 是一名值得学习的语言
……

[1]: http://www.2ality.com/2012/09/expressions-vs-statements.html